<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Cloud Library</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="theme-color" content="#2c3e50">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <div id="detail-overlay" style="display: none;">
        <div class="detail-box">
            <button class="btn-close-detail" onclick="closeBookDetails()"><i class="fas fa-times"></i></button>
            <div class="detail-header">
                <img id="detail-img" src="" alt="Cover">
                <div class="detail-info">
                    <h2 id="detail-title">Title</h2>
                    <p id="detail-author">Author</p>
                    <p id="detail-year" class="meta-text">Year: N/A</p>
                </div>
            </div>
            <hr>
            <div class="dates-section">
                <div class="date-group">
                    <label>Started</label>
                    <input type="date" id="date-start">
                </div>
                <div class="date-group">
                    <label>Finished</label>
                    <input type="date" id="date-finish">
                </div>
                <p id="reading-duration" class="meta-text"></p>
            </div>
            <div class="rating-section">
                <h3>My Rating</h3>
                <div class="stars" id="star-container">
                    <i class="far fa-star" onclick="setRating(1)"></i>
                    <i class="far fa-star" onclick="setRating(2)"></i>
                    <i class="far fa-star" onclick="setRating(3)"></i>
                    <i class="far fa-star" onclick="setRating(4)"></i>
                    <i class="far fa-star" onclick="setRating(5)"></i>
                </div>
            </div>
            <div class="notes-section">
                <h3>Personal Notes</h3>
                <textarea id="detail-notes" placeholder="Write your thoughts here..."></textarea>
            </div>
            <button class="btn-save-detail" onclick="saveBookDetails()">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </div>
    </div>

    <div id="login-overlay">
        <div class="login-box">
            <h1><i class="fas fa-book-open"></i> My Library</h1>
            <p>Save your books in the cloud and access them everywhere.</p>
            <button class="btn-google" onclick="loginWithGoogle()"><i class="fab fa-google"></i> Sign in with Google</button>
            <button class="btn-guest" onclick="loginAsGuest()"><i class="fas fa-user-secret"></i> Continue as Guest</button>
            <p class="small-info">Guest mode saves data on this device only.</p>
        </div>
    </div>

    <header>
        <div class="header-top-row">
            <div class="user-info">
                <span id="user-display-name">Guest</span>
                <button onclick="logout()" class="btn-logout"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>
        
        <nav class="top-nav">
            <button class="nav-btn" onclick="switchView('search')" id="nav-search">
                <i class="fas fa-search"></i>
                <span>Search</span>
            </button>
            <button class="nav-btn active" onclick="switchView('collection')" id="nav-collection">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </button>
            <button class="nav-btn" onclick="switchView('stats')" id="nav-stats">
                <i class="fas fa-chart-pie"></i>
                <span>Stats</span>
            </button>
            <button class="nav-btn" onclick="switchView('suggestions')" id="nav-suggestions">
                <i class="fas fa-lightbulb"></i>
                <span>Ideas</span>
            </button>
        </nav>
    </header>

    <main>
        <div id="view-search" class="view-section" style="display: none;">
            <div class="section-header">
                <h2>Add New Books</h2>
            </div>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search title or author...">
                <button onclick="searchBooks()"><i class="fas fa-search"></i></button>
            </div>
            <div id="search-results" class="results-grid"></div>
        </div>

        <div id="view-collection" class="view-section">
            <div class="profile-area">
                <div class="profile-pic-wrapper" onclick="document.getElementById('profile-upload').click()">
                    <img id="profile-pic-display" src="https://via.placeholder.com/150?text=+" alt="Profile">
                    <div class="edit-icon"><i class="fas fa-camera"></i></div>
                </div>
                <input type="file" id="profile-upload" accept="image/*" hidden onchange="uploadProfilePhoto(this)">
                <h2 id="profile-name-large">Guest User</h2>
                <div class="dark-mode-toggle" onclick="toggleDarkMode()">
                    <i class="fas fa-moon"></i>
                    <span>Dark Mode</span>
                    <div class="toggle-switch"><div class="toggle-circle"></div></div>
                </div>
            </div>

            <div class="section-header">
                <h2>My Collection</h2>
                <select id="sort-select" onchange="changeSort()">
                    <option value="newest">Newest</option>
                    <option value="title">Title (A-Z)</option>
                    <option value="author">Author (A-Z)</option>
                </select>
            </div>

            <div class="filters">
                <button onclick="filterLibrary('all')" class="active">All</button>
                <button onclick="filterLibrary('owned')"><i class="fas fa-archive"></i> Owned</button>
                <button onclick="filterLibrary('reading')"><i class="fas fa-book-open"></i> Reading</button>
                <button onclick="filterLibrary('read')"><i class="fas fa-check"></i> Read</button>
            </div>
            
            <div id="my-library" class="library-grid">
                <p class="loading-msg">Loading books...</p>
            </div>
        </div>

        <div id="view-stats" class="view-section" style="display: none;">
            <div class="section-header"><h2>My Statistics</h2></div>
            <div class="challenge-card">
                <div class="challenge-header">
                    <h3><i class="fas fa-trophy"></i> Reading Challenge</h3>
                    <div class="challenge-goal-input">
                        <span>Goal:</span>
                        <input type="number" id="challenge-goal" value="12" min="1" onchange="saveGoal()">
                    </div>
                </div>
                <p class="challenge-text">You have read <strong id="challenge-read-count">0</strong> of <strong id="challenge-target-display">12</strong> books.</p>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="challenge-progress" style="width: 0%"></div>
                </div>
            </div>

            <div class="stats-container">
                <div class="stat-card blue">
                    <i class="fas fa-book"></i>
                    <h3 id="stat-total">0</h3>
                    <p>Total Saved</p>
                </div>
                <div class="stat-card green">
                    <i class="fas fa-check-double"></i>
                    <h3 id="stat-read">0</h3>
                    <p>Books Read</p>
                </div>
                <div class="stat-card orange">
                    <i class="fas fa-archive"></i>
                    <h3 id="stat-owned">0</h3>
                    <p>Books Owned</p>
                </div>
            </div>

            <div class="top-authors-section">
                <h3><i class="fas fa-crown"></i> Top Authors</h3>
                <ul id="top-authors-list"></ul>
            </div>
        </div>

        <div id="view-suggestions" class="view-section" style="display: none;">
            <div class="section-header">
                <h2>Suggested for You</h2>
                <button class="btn-refresh" onclick="generateSuggestions(true)"><i class="fas fa-sync-alt"></i></button>
            </div>
            
            <div id="suggestion-reason" class="suggestion-reason">
                </div>

            <div id="suggestions-grid" class="results-grid">
                <p class="loading-msg">Open your library to get suggestions!</p>
            </div>
        </div>

    </main>

    <script src="script.js"></script>
</body>
</html>